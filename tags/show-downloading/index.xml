<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom" xmlns:content="http://purl.org/rss/1.0/modules/content/"><channel><title>show downloading on Shallow and Pedantic</title><link>https://lutzky.net/tags/show-downloading/</link><description>Recent content in show downloading on Shallow and Pedantic</description><generator>Hugo -- gohugo.io</generator><language>en-us</language><lastBuildDate>Sun, 05 Jan 2014 00:00:00 +0000</lastBuildDate><atom:link href="https://lutzky.net/tags/show-downloading/index.xml" rel="self" type="application/rss+xml"/><item><title>Weird permission issues with tvnamer</title><link>https://lutzky.net/2014/01/05/investigate/</link><pubDate>Sun, 05 Jan 2014 00:00:00 +0000</pubDate><guid>https://lutzky.net/2014/01/05/investigate/</guid><description>Distinguishing &lt;!-- raw HTML omitted -->EPERM&lt;!-- raw HTML omitted --> vs &lt;!-- raw HTML omitted -->EACCESS&lt;!-- raw HTML omitted -->, and how that helps debug file manipulation scripts.</description><content:encoded><![CDATA[<p>My show downloading stack lives on. I&rsquo;m curious as to which will happen first: NetFlix hits Israel, or I switch over to Sick Beard.</p>
<p>At any rate, nowadays I use <code>flexget</code>, <code>transmission</code>, <code>tvnamer</code> and <code>xbmc</code>, held together with some bash scripts. On debian- and ubuntu-based systems, the <code>transmission</code> daemon runs as a separate user (<code>debian-transmission</code>), so this requires a bit of care with file and group ownership. After rebuilding my system, I couldn&rsquo;t get <code>tvnamer</code> to work right for some reason, no matter how careful I was. I&rsquo;d keep getting this error:</p>
<div class="highlight"><pre class="chroma"><code class="language-text" data-lang="text">Loading config: config.json
####################
# Starting tvnamer
# Found 1 episode
####################
# Processing file: Sherlock.S03E01.mkv
# Detected series: Sherlock (season: 3, episode: 1)
####################
Old filename: Sherlock.3x01.The.Empty.Hearse.720p.HDTV.x264-FoV.mkv
New filename: Sherlock - [03x01] - The Empty Hearse.mkv
New path: /home/debian-transmission/inbox/Sherlock - [03x01] - The Empty Hearse.mkv
Creating directory /home/debian-transmission/inbox
rename Sherlock.3x01.The.Empty.Hearse.720p.HDTV.x264-FoV.mkv to /home/debian-transmission/inbox/Sherlock - [03x01] - The Empty Hearse.mkv
OSError(1, &#39;Operation not permitted&#39;)
New path: /media/Store/shows/Sherlock/Season 3/Sherlock.3x01.The.Empty.Hearse.720p.HDTV.x264-FoV.mkv
Creating directory /media/Store/Shows/Sherlock/Season 3
OSError(2, &#39;No such file or directory&#39;)
</code></pre></div><p>For a few weeks I&rsquo;d double-check the permissions, fail to understand what was going on, groan and copy the files manually. The new Sherlock episode had me in a bit of a more investigative mood.</p>
<p>This turns out to be an exercise in confusing OS logic and logging. It <em>looks</em> like the rename operation failed, and somehow the directory creation failed as well. Neither is the case. A hint can be found in the precise error after the rename: &ldquo;1 - Operation not permitted&rdquo; (that&rsquo;s <code>EPERM</code>). If that seems a bit off, that&rsquo;s because it is: When renames fail because of inadequate permissions, they return <code>EACCES</code> &ldquo;13 - Permission denied&rdquo;. So what&rsquo;s going on?</p>
<p>It turns out that after renaming, <code>tvnamer</code> tries to preserve the access and modification times of renamed files. A noble cause, but it turns out that Linux won&rsquo;t allow this unless you are the <em>owner</em> of the file - even if you do have write permissions. Therefore, this fails, which causes <code>tvnamer</code> to believe the rename failed - although it hasn&rsquo;t. Afterwards, the directory is created (this succeeds), but since <code>tvnamer</code> tries to copy using the <em>old</em> filename (thinking the rename failed), we get an <code>ENOENT</code> &ldquo;2 - No such file or directory&rdquo; error about the <em>source</em> of the copy operation.</p>
<p>The fix can be found <a href="https://github.com/dbr/tvnamer/pull/89">in this pull request</a>. Happy bug hunting!</p>
]]></content:encoded></item><item><title>The show downloading stack - part n+1</title><link>https://lutzky.net/2011/12/15/the-show-downloading-stack-part-n1/</link><pubDate>Thu, 15 Dec 2011 00:00:00 +0000</pubDate><guid>https://lutzky.net/2011/12/15/the-show-downloading-stack-part-n1/</guid><description>I&amp;rsquo;ve already mentioned my show downloading stack on this blog. It&amp;rsquo;s changed a bit since - I now use Transmission rather than rtorrent, as it has the excellent transmission-daemon package which has it acting exactly the way I like (without using screen). Also, it now E-mails me when a torrent is done downloading. So while this may be how TV works for you:
Notice that a new episode is out Torrent it Wait for the download to finish Watch it &amp;hellip;this is how TV works for me now:</description><content:encoded><![CDATA[<p>I&rsquo;ve <a href="/2009/09/05/my-show-downloading-stack">already mentioned</a> my show downloading stack on this blog. It&rsquo;s
changed a bit since - I now use <a href="http://transmission-bt.org/">Transmission</a>
rather than rtorrent, as it has the excellent <code>transmission-daemon</code> package
which has it acting exactly the way I like (without using <code>screen</code>). Also, it
now E-mails me when a torrent is done downloading. So while this may be how TV
works for you:</p>
<ol>
<li>Notice that a new episode is out</li>
<li>Torrent it</li>
<li>Wait for the download to finish</li>
<li>Watch it</li>
</ol>
<p>&hellip;this is how TV works for me now:</p>
<ol>
<li>Receive E-mail notification of a new downloaded episode</li>
<li>Watch it</li>
</ol>
<p>Here&rsquo;s how it&rsquo;s done: First, write <code>/usr/local/bin/notify_torrent_done</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>cat_the_message<span class="o">()</span> <span class="o">{</span>
cat <span class="s">&lt;&lt;EOF
</span><span class="s">Subject: Torrent done: $TR_TORRENT_NAME
</span><span class="s">
</span><span class="s">Hello from transmission $TR_APP_VERSION at $(hostname). The following torrent
</span><span class="s">has completed:
</span><span class="s">
</span><span class="s">Name: $TR_TORRENT_NAME
</span><span class="s">Finished at: $TR_TIME_LOCALTIME
</span><span class="s">Downloaded to: $TR_TORRENT_DIR
</span><span class="s">Hash: $TR_TORRENT_HASH
</span><span class="s">
</span><span class="s">Enjoy!
</span><span class="s">EOF</span>
<span class="o">}</span>

<span class="nv">RETVAL</span><span class="o">=</span><span class="m">1</span>

<span class="k">while</span> <span class="o">[[</span> <span class="nv">$RETVAL</span> !<span class="o">=</span> <span class="m">0</span> <span class="o">]]</span><span class="p">;</span> <span class="k">do</span>
    cat_the_message <span class="p">|</span> msmtp -C /etc/msmtprc.transmission --from default -t your@email.address
    <span class="nv">RETVAL</span><span class="o">=</span><span class="nv">$?</span>
<span class="k">done</span>
</code></pre></div><p>The various environment variables will be set by transmission when it calls
this script. We rerun <code>msmtp</code> until it succeeds because you will often get a
&ldquo;connection timed out&rdquo; response from gmail (&hellip;at least on my ISP&hellip;). Here&rsquo;s
<code>/etc/msmtprc.transmission</code> which is relevant to gmail (this is a bit tricky
and took a lot of fiddling around with):</p>
<pre><code>defaults
tls on
tls_starttls on
tls_trust_file /etc/ssl/certs/ca-certificates.crt
timeout 60

account default
host smtp.gmail.com
port 587
auth on
user yourusername@gmail.com
password yourpasswordhere
from yourusername@gmail.com
syslog LOG_MAIL
</code></pre><p>As usual, caution is required when saving your password in plaintext. I highly
recommend using Google&rsquo;s two-step authentication, which will have you creating
a one-time password for each application - use one of those one-time passwords
here.</p>
<p>Finally, in <code>/etc/transmission-daemon/settings.json</code>, add the following code:</p>
<pre><code>&quot;script-torrent-done-enabled&quot;: true,
&quot;script-torrent-done-filename&quot;: &quot;/usr/local/bin/notify_torrent_done&quot;,
</code></pre><p><strong>Important:</strong> You need to run <code>/etc/init.d/transmission-daemon reload</code> at
this point, not <code>restart</code> - that would cause <code>settings.json</code> to be
rewritten from runtime configuration.</p>
<p>That&rsquo;s it. Enjoy!</p>
]]></content:encoded></item><item><title>Loving the new Totem</title><link>https://lutzky.net/2009/10/10/loving-the-new-totem/</link><pubDate>Sat, 10 Oct 2009 00:00:00 +0000</pubDate><guid>https://lutzky.net/2009/10/10/loving-the-new-totem/</guid><description>Totem is Gnome&amp;rsquo;s built-in media player, and it really annoyed me in previous versions, and had me switching to VLC. However, the version included in the Ubuntu 9.10 release candidate has two features which are very important, in my opinion. The first feature is smooth graphical integration with compositing managers (such as compiz). In previous versions, as well as VLC, once you fullscreen the window, moving the mouse (which causes the cursor and the partial interface to appear) causes a very annoying flicker.</description><content:encoded><![CDATA[<p>Totem is Gnome&rsquo;s built-in media player, and it really annoyed me in previous
versions, and had me switching to VLC. However, the version included in the
Ubuntu 9.10 release candidate has two features which are very important, in my
opinion. The first feature is smooth graphical integration with compositing
managers (such as compiz). In previous versions, as well as VLC, once you
fullscreen the window, moving the mouse (which causes the cursor and the
partial interface to appear) causes a very annoying flicker. This has been
fixed (at least on my box, using an NVidia card).</p>
<p>The second, more important feature, is the exact one I&rsquo;ve been missing and
talked about in <a href="/2009/09/05/my-show-downloading-stack">the previous post</a> - hit Edit -&gt; Preferences -&gt; Start
playing files from last position, and Totem will keep track of your last
playback position when you close the video. Reading <a href="http://article.gmane.org/gmane.comp.gnome.svn/223873">the implementation
patch</a> shows that there
is a certain threshold for this - the position won&rsquo;t be saved if you&rsquo;re too
close to the beginning or end of the video. So there, my show downloading stack
now has every feature I&rsquo;d want from Miro, without the downsides I&rsquo;ve mentioned.</p>
]]></content:encoded></item><item><title>My show downloading stack</title><link>https://lutzky.net/2009/09/05/my-show-downloading-stack/</link><pubDate>Sat, 05 Sep 2009 00:00:00 +0000</pubDate><guid>https://lutzky.net/2009/09/05/my-show-downloading-stack/</guid><description>I love watching TV, and hate it. Regular show schedules are horrible, commercial breaks are annoying, and the ability to rewind is very important. I love Hot&amp;rsquo;s VOD service (and happily pay to watch the shows I enjoy), but my true favorite for getting my entertainment is everyone&amp;rsquo;s favorite not-a-dumptruck, the internet. In this post, I will describe how I do it.
Everything I describe in this post can be done using miro.</description><content:encoded><![CDATA[<p>I love watching TV, and hate it. Regular show schedules are horrible,
commercial breaks are annoying, and the ability to rewind is very important. I
love Hot&rsquo;s VOD service (and happily pay to watch the shows I enjoy), but my
true favorite for getting my entertainment is everyone&rsquo;s favorite
not-a-dumptruck, the internet. In this post, I will describe how I do it.</p>
<p>Everything I describe in this post can be done using
<a href="http://getmiro.com/">miro</a>. It&rsquo;s a neat piece of software, which lacked polish
in version 2.4 (2.5 is out now though), but there are a few things I don&rsquo;t like
about it:</p>
<ul>
<li>You have to be graphically logged in for it to run. Among other things, this
means that if someone reboots your computer, there&rsquo;s no way to get it to
start automatically. (I&rsquo;ll be very happy to know if I&rsquo;m wrong about this)</li>
<li>It doesn&rsquo;t give you as much control as I&rsquo;d like over torrents.</li>
<li>Its BitTorrent client doesn&rsquo;t perform as well as rtorrent.</li>
</ul>
<p>However, Miro does one thing which I haven&rsquo;t figured out how to do myself yet:
It keeps track of your position within watched shows. That is, stop watching a
show -and next time playback will resume from the same place.</p>
<p>The first thing you want to do is get a good RSS feed for your show.
Unfortunately, <a href="http://revision3.com/">Revision3</a>&rsquo;s shows (many of which are
quite good), are direct HTTP download links, as per the advertiser&rsquo;s request.
For other shows, you can find torrent RSS feeds, which make much better use of
everyone&rsquo;s bandwidth. Also, downloading will be handled by our trusty rtorrent,
which we can configure for bandwidth limiting.</p>
<p>To download RSS feeds, I use <a href="http://flexget.com/">flexget</a>. It does its job
well, but doesn&rsquo;t support bandwidth limiting. It accepts a simple YAML
configuration file, and has good logging. I run it as a cron job - its locking
mechanism prevents multiple instances from running simultaneously. For
non-torrents, I set the output directory to <code>~/torrents/inbox</code>. For torrents, I
set the output directory to <code>~/torrents/from_rss</code>.</p>
<p>For downloading torrents, I use <a href="http://libtorrent.rakshasa.no/">rtorrent</a>.
It&rsquo;s a curses-based client which performs very well. My <code>.rtorrent.rc</code> file looks
like this:</p>
<pre><code>download_rate = 30
upload_rate = 2
directory = /home/ohad/torrents/in_progress
on_finished = move_complete,&quot;execute=mv,-u,$d.get_base_path=,~/torrents/inbox/ ;d.set_directory=~/torrents/inbox/&quot;
session = /home/ohad/torrents/.session
schedule = watch_directory,5,5,load_start=/home/ohad/torrents/from_rss/*.torrent
schedule = untied_directory,5,5,remove_untied=
schedule = throttle_1,23:00:00,24:00:00,download_rate=0
schedule = throttle_2,05:00:00,24:00:00,download_rate=30
port_range = 6881-6889
encryption = allow_incoming,enable_retry,prefer_plaintext
dht = auto
peer_exchange = yes
scgi_local = /tmp/rtorrent-scgi.socket
</code></pre><p>Interesting things to note here are:</p>
<ul>
<li>Downloads live in one directory, but get moved to the inbox directory when
they&rsquo;re done.</li>
<li>The session directory is important - this allows rtorrent to resume downloads
if it&rsquo;s shut down.</li>
<li>The <code>from_rss</code> directory is watched for new torrent files. When the relevant
downloads are stopped, <code>remove_untied</code> occurs and the torrent files are
deleted.</li>
<li>Throttling is fully customizable.</li>
<li>The SCGI socket is useful for <code>rtgui</code> - we&rsquo;ll get to that.</li>
</ul>
<p>I have a &ldquo;watchdog&rdquo;-style cron job which makes sure it&rsquo;s running if the
computer is up. This is not as elegant as starting it from an RC-script, but
keeps the whole setup confined to the limits of my own user. Again, rtorrent
has a lock-file which prevents multiple instances from running.</p>
<div class="highlight"><pre class="chroma"><code class="language-bash" data-lang="bash"><span class="cp">#!/bin/bash
</span><span class="cp"></span>
<span class="c1"># A simple script to make sure I am running rtorrent in a screen</span>

<span class="nb">set</span> -e

<span class="nv">SCGI_SOCKET</span><span class="o">=</span>/tmp/rtorrent-scgi.socket
<span class="nv">SESSION_DIR</span><span class="o">=</span>~/torrents/.session

screen -d -m -fn -S rtorrent -s /bin/bash -t rtorrent -m nice rtorrent

<span class="k">while</span> <span class="o">[[</span> ! -S <span class="nv">$SCGI_SOCKET</span> <span class="o">]]</span><span class="p">;</span> <span class="k">do</span> sleep 1<span class="p">;</span> <span class="k">done</span>

<span class="k">if</span> <span class="o">[[</span> -S <span class="nv">$SCGI_SOCKET</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
    chgrp www-data <span class="nv">$SCGI_SOCKET</span>
    chmod g+rwx <span class="nv">$SCGI_SOCKET</span>
<span class="k">fi</span>
</code></pre></div><p><a href="http://code.google.com/p/rtgui/">RTGUI</a> provides a nice web-based interface.
It&rsquo;s a bit tricky to configure, and you&rsquo;ll need to use an HTTP server -
preferably lighttpd, as it has support for SCGI UNIX sockets (as opposed to
SCGI TCP sockets). This lets you keep the number of open network ports to a
minimum. This is all well-documented on the RTGUI site.</p>
<p>Finally, I&rsquo;ve written a little python script called
<a href="http://github.com/lutzky/check_shows">check_shows</a> which uses <code>libnotify</code> to
show a pretty pop-up whenever downloads complete. It&rsquo;s a tiny little hack which
uses inotify, which is lots of fun.</p>
<p>That&rsquo;s it. Any neat tricks are welcome :)</p>
]]></content:encoded></item><item><title>Alright, American Dad!</title><link>https://lutzky.net/2007/01/23/alright-american-dad/</link><pubDate>Tue, 23 Jan 2007 00:00:00 +0000</pubDate><guid>https://lutzky.net/2007/01/23/alright-american-dad/</guid><description>Just finished downloading an episode of American Dad off Bittorrent. TV has ancient episodes of Family Guy. Took about an hour though&amp;hellip; I tells ya, I&amp;rsquo;d pay for this kind of service if it were faster&amp;hellip; ;)</description><content:encoded><![CDATA[<p>Just finished downloading an episode of American Dad off Bittorrent. TV has
ancient episodes of Family Guy. Took about an hour though&hellip; I tells ya, I&rsquo;d
pay for this kind of service if it were faster&hellip; ;)</p>
]]></content:encoded></item></channel></rss>